<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ashoka Universal School - Academic Portal</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-green: #006400;
            --golden-yellow: #FFD700;
            --light-bg: #F8F8F0;
            --card-bg: #ffffff;
            --text-main: #333333;
            --border: #E0E0E0;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--light-bg);
            color: var(--text-main);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            width: 90%;
            max-width: 800px;
            background: var(--card-bg);
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border-top: 8px solid var(--primary-green);
        }

        h1 { color: var(--primary-green); text-align: center; margin-bottom: 30px; }

        /* Login Layout */
        .login-box { display: flex; flex-direction: column; gap: 15px; max-width: 400px; margin: 0 auto; }
        input {
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            outline: none;
        }
        input:focus { border-color: var(--primary-green); }

        /* Quiz Layout */
        .quiz-header {
            display: flex;
            justify-content: space-between;
            border-bottom: 2px solid var(--border);
            padding-bottom: 10px;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .question-text { font-size: 1.2rem; margin-bottom: 25px; line-height: 1.6; }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }

        .option-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border: 2px solid var(--border);
            border-radius: 10px;
            cursor: pointer;
            transition: 0.2s;
        }

        .option-item:hover { background-color: #f9f9f9; border-color: var(--primary-green); }
        .option-item.selected { 
            background-color: #f0f7f0; 
            border-color: var(--primary-green); 
            font-weight: 600;
        }

        input[type="radio"] { margin-right: 15px; accent-color: var(--primary-green); transform: scale(1.2); }

        .btn {
            background-color: var(--primary-green);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            font-size: 1rem;
            width: 100%;
            margin-top: 20px;
        }

        .btn-next { background-color: var(--golden-yellow); color: #333; width: auto; float: right; }

        .hidden { display: none; }
        #error-msg { color: #d93025; text-align: center; font-size: 0.9rem; }
    </style>
</head>
<body>

<div class="container">
    <div id="login-page">
        <h1>Student Exam Login</h1>
        <div class="login-box">
            <input type="text" id="user" placeholder="Username">
            <input type="password" id="pass" placeholder="Password">
            <p id="error-msg" class="hidden">Invalid credentials. Please try again.</p>
            <button class="btn" onclick="attemptLogin()">Enter Portal</button>
        </div>
    </div>

    <div id="exam-page" class="hidden">
        <div class="quiz-header">
            <span id="meta-subject" style="color: var(--primary-green);">Subject</span>
            <span id="meta-progress">Question 1/20</span>
        </div>
        <div class="question-text" id="q-text"></div>
        <div class="options-grid" id="options-container"></div>
        <div style="overflow: auto;">
            <button class="btn btn-next" onclick="handleNext()" id="next-btn">Next Question ➔</button>
        </div>
    </div>

    <div id="result-page" class="hidden" style="text-align: center;">
        <h1 style="font-size: 3rem;">✔</h1>
        <h2>Exam Completed</h2>
        <p>Your responses have been securely transmitted to the host server.</p>
        <button class="btn" onclick="location.reload()" style="max-width: 200px;">Exit</button>
    </div>
</div>

<script>
    const questions = [
        { id: 1, sub: "SAT Math", q: "If 2x + 3 = 11, what is the value of 4x - 5?", opts: ["11", "13", "16", "19"] },
        { id: 2, sub: "JEE Physics", q: "The unit of electric flux is:", opts: ["Weber", "Newton/Coulomb", "Volt-meter", "Tesla"] },
        { id: 3, sub: "SAT Verbal", q: "Which word is a synonym for 'Meticulous'?", opts: ["Careless", "Thorough", "Fast", "Angry"] },
        { id: 4, sub: "JEE Chemistry", q: "The bond angle in CH4 is:", opts: ["109.5°", "120°", "90°", "180°"] },
        { id: 5, sub: "SAT Math", q: "What is the area of a circle with a diameter of 10?", opts: ["10π", "20π", "25π", "100π"] },
        { id: 6, sub: "JEE Physics", q: "In a concave mirror, if an object is at 'C', the image is at:", opts: ["F", "C", "Infinity", "Between C and F"] },
        { id: 7, sub: "SAT Verbal", q: "Identify the antonym of 'Amicable':", opts: ["Friendly", "Hostile", "Polite", "Calm"] },
        { id: 8, sub: "JEE Math", q: "The value of sin(45°) + cos(45°) is:", opts: ["1", "√2", "2", "0"] },
        { id: 9, sub: "SAT Verbal", q: "The ______ witness provided evidence that cleared the suspect.", opts: ["Reluctant", "Biased", "Impartial", "Hostile"] },
        { id: 10, sub: "JEE Chemistry", q: "The oxidation state of Oxygen in H2O2 is:", opts: ["-2", "-1", "0", "+1"] },
        { id: 11, sub: "SAT Math", q: "If a:b = 3:4 and b:c = 8:9, what is a:c?", opts: ["1:3", "2:3", "3:2", "1:2"] },
        { id: 12, sub: "JEE Physics", q: "Resistance of an ideal voltmeter is:", opts: ["Zero", "Infinite", "100 Ohm", "1 Ohm"] },
        { id: 13, sub: "SAT Math", q: "The sum of angles in a hexagon is:", opts: ["360°", "540°", "720°", "900°"] },
        { id: 14, sub: "JEE Chemistry", q: "Which gas is known as Laughing Gas?", opts: ["NO", "N2O", "NO2", "N2O5"] },
        { id: 15, sub: "SAT Verbal", q: "Correct the sentence: 'She don't like apples.'", opts: ["She doesn't like", "She not like", "She don't likes", "No change"] },
        { id: 16, sub: "JEE Physics", q: "Dimensional formula for Force is:", opts: ["MLT-1", "MLT-2", "ML2T-2", "ML-1T-2"] },
        { id: 17, sub: "SAT Math", q: "If 15% of n is 45, what is n?", opts: ["300", "400", "450", "600"] },
        { id: 18, sub: "JEE Math", q: "Log 1 to any base is:", opts: ["1", "0", "Base value", "Undefined"] },
        { id: 19, sub: "SAT Verbal", q: "A 'Pinnacle' is a:", opts: ["Base", "Peak", "Valley", "Tunnel"] },
        { id: 20, sub: "JEE Chemistry", q: "Which element has the highest Electronegativity?", opts: ["Oxygen", "Chlorine", "Fluorine", "Nitrogen"] }
    ];

    let currentIdx = 0;
    let studentResponses = {};
    let loggedInUser = "";

    async function attemptLogin() {
        const username = document.getElementById('user').value;
        const password = document.getElementById('pass').value;
        const error = document.getElementById('error-msg');

        const res = await fetch('/login', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ username, password })
        });

        if (res.ok) {
            loggedInUser = username;
            document.getElementById('login-page').classList.add('hidden');
            document.getElementById('exam-page').classList.remove('hidden');
            renderQuestion();
        } else {
            error.classList.remove('hidden');
        }
    }

    function renderQuestion() {
        const qData = questions[currentIdx];
        document.getElementById('meta-subject').textContent = qData.sub;
        document.getElementById('meta-progress').textContent = `Question ${currentIdx + 1}/20`;
        document.getElementById('q-text').textContent = `${currentIdx + 1}. ${qData.q}`;
        
        const container = document.getElementById('options-container');
        container.innerHTML = '';

        qData.opts.forEach((opt, i) => {
            const div = document.createElement('div');
            div.className = 'option-item';
            div.innerHTML = `<input type="radio" name="answer" value="${i+1}"> <span>${opt}</span>`;
            div.onclick = () => {
                div.querySelector('input').checked = true;
                document.querySelectorAll('.option-item').forEach(el => el.classList.remove('selected'));
                div.classList.add('selected');
            };
            container.appendChild(div);
        });

        if(currentIdx === 19) document.getElementById('next-btn').textContent = "Submit Final Exam";
    }

    async function handleNext() {
        const selected = document.querySelector('input[name="answer"]:checked');
        if (!selected) return alert("Please select an answer.");

        studentResponses[questions[currentIdx].id] = parseInt(selected.value);
        currentIdx++;

        if (currentIdx < questions.length) {
            renderQuestion();
        } else {
            const res = await fetch('/submit-exam', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ username: loggedInUser, answers: studentResponses })
            });
            if (res.ok) {
                document.getElementById('exam-page').classList.add('hidden');
                document.getElementById('result-page').classList.remove('hidden');
            }
        }
    }
</script>
</body>
</html>